---
title: "Code Review"
date: 2020-07-16T13:41:37+02:00
draft: false
---


#### Running SonarQube for .NET code using Docker
Before starting, make sure you have your .NET solution (.sln) locally on a system that can run it. Make sure all dependencied are installed and it will build using Visual Studio.

Run Docker image of SonarQube:
```sudo docker run -d --name sonarqube -p 9000:9000 -p 9092:9092 sonarqube```

Browse to http://localhost:9000 and login using admin:admin. You will be prompted to change your password. 
* Click "Add Project"
* Select "Manually"
* Enter a "Product key" to name the project
* Generate a token, and save this somewhere locally. It cannot be obtained after this page (new ones can be generated though)
* Select .NET to run analysis for
* Choose your build tool and copy the commands to run them in a later stage

SonarQube is now setup and ready to go. Next, the SonarScanner tool has to be run to analyse the code and report back to your SonarQube instance.

* Install Java
* Download and extract SonarScanner from GitHub: https://github.com/SonarSource/sonar-scanner-msbuild/releases/

Open a command prompt and make sure you're in the directory where the .sln of the project is located. Assuming your SonarQube instance is running on localhost, use the following command to analyse:

```
<path_to_sonar-scanner_folder>\bin\sonar-scanner -Dsonar.login=1<token> -Dsonar.projectKey=<projectkey>
```

Additionally you might want to run the SonarScanner form Docker as well, as per these instructions: https://docs.sonarqube.org/latest/analysis/scan/sonarscanner/

#### Using Security Code Scan Extension for Visual Studio
See https://security-code-scan.github.io/ for more details.

* Install Security Code Scan using the Extensions manager in Visual Studio
* Go to Tools > Options > Text Editor > C# (or Basic) > Advanced. Make sure the “Entire solution” is selected.
* Build the solution

Error/ Warning messages should now pop up in the Error List.

#### Interesting things to check
* Inspect user input
* Inspect communication witht the Database (are prepared SQL statements used or plain SQL statements?)
* Inspect for unsafe eval functions
* Inspect whether the eval functions that are used are actually effective (some eval functions don't properly encode, so look up documentation about these functions)
* Inspect document processing functions (e.g. XML processing)

Note: the fact that proper eval or document processing functions or libraries are used, doesn't mean there safe. Check whether the libraries used contain vulnerabilities.