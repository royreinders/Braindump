---
title: "Internal Infrastructure"
date: 2020-07-16T13:41:37+02:00
draft: false
---

#### Using Bettercap to MITM and catch hashes (TO WORK OUT)
1. Generate smb relay list with crackmapexec
2. Set up ntlmrelayx with smb2support and -socks
3. Fire up responder + bettercap (arp,dns+dhcpv6 spoofing)
4. ntlmrelayx sessions can be used with atexec and smbexec

```js
This is some code
```

#### MITM6 with ntlmrelayx ToDo

#### Finding DC using Kerbrute
Whether the usernames.txt in the following command contains valid usernames or not., the output will contain the DC's which kerbrute uses to identify the users with.
```kerbrute userenum -d <domanin> usernames.txt```

#### Password spraying using SMB with CME

```crackmapexec smb <DomainController> -d <Domain> -u users.txt -p Welkom01 --continue-on-success```

#### Retrieve domain name from DHCP broadcast traffic

DHCP packets that are broadcast over the network will likely expose the domain names used in the internal network. Look for the "domain-name" or "domain-search" fields in DHCP (BOOTP for Wireshark filter) packets. Alternatively, use the nmap script "broadcast-dhcp-dicover", with the following sytax:
```
nmap --script broadcast-dhcp-dicover
```

#### Retrieve domain name from DNS reverse lookup
If you're connected to an internal network, you're likely already using a DNS server that can resolve internal domain names. You can do a reverse lookup using ```ping -a <ip-address>``` or scan a whole subnet with a tool like dnsrecon:
```
dnsrecon -r 10.0.03.0/24 -n 10.0.3.200
```

#### Retrieve LDAP data fr

